# D2 Diagram Generator

Generate D2 diagrams - a modern declarative diagramming language with animated and interactive support.

## Why D2?

D2 excels at:
- Animated diagrams (connections animate on hover)
- Better auto-layout than Mermaid
- SQL table rendering
- LaTeX support in labels
- Sequence diagrams with better syntax
- More control over styling

## Instructions

When the user provides a description, follow these steps:

1. **Parse flags** - Check for optional flags:
   - `--sketch` or `-s` - Hand-drawn sketch style
   - `--dark` or `-d` - Dark theme (default)
   - `--light` or `-l` - Light theme
   - `--animate` or `-a` - Generate SVG with animations
   - `--layout <engine>` - Layout engine: dagre (default), elk, tala

2. **Analyze the request** - D2 supports:
   - Flowcharts and architecture diagrams
   - Sequence diagrams
   - Class diagrams
   - SQL/Table diagrams
   - Grid layouts
   - Icons from many sources

3. **Generate D2 syntax** - Create valid D2 code

4. **Save the .d2 file** - Write to `diagrams/<descriptive-name>.d2`

5. **Render** - Run:
   ```bash
   # PNG output (default)
   ~/.local/bin/d2 --theme=<theme> diagrams/<name>.d2 diagrams/<name>.png

   # SVG with animations
   ~/.local/bin/d2 --theme=<theme> --animate-interval=1000 diagrams/<name>.d2 diagrams/<name>.svg
   ```

   Theme values:
   - Default dark: `200` (Dark Mauve)
   - Light: `0` (default)
   - Sketch: use `--sketch` flag

6. **Show the result** - Display the generated diagram

## D2 Syntax Quick Reference

### Basic Shapes
```d2
# Connections
a -> b: label
a -- b: bidirectional

# Shapes
box: { shape: rectangle }
oval: { shape: oval }
cylinder: { shape: cylinder }
cloud: { shape: cloud }
queue: { shape: queue }
page: { shape: page }
person: { shape: person }

# Containers (groups)
container: {
  inner1
  inner2
}
```

### Sequence Diagrams
```d2
shape: sequence_diagram

alice -> bob: Hello
bob -> alice: Hi back
alice -> charlie: Forward message
```

### SQL Tables
```d2
users: {
  shape: sql_table
  id: int {constraint: primary_key}
  name: varchar(255)
  email: varchar(255) {constraint: unique}
  created_at: timestamp
}

posts: {
  shape: sql_table
  id: int {constraint: primary_key}
  user_id: int {constraint: foreign_key}
  title: varchar(255)
  body: text
}

users.id -> posts.user_id
```

### Grid Layout
```d2
grid-rows: 2
grid-columns: 3

cell1
cell2
cell3
cell4
cell5
cell6
```

### Icons
```d2
# Using built-in icons
github: {
  icon: https://icons.terrastruct.com/dev%2Fgithub.svg
}

# Simple icon shapes
user: { shape: person }
db: { shape: cylinder }
cloud: { shape: cloud }
```

### Styling
```d2
a: {
  style: {
    fill: "#ff6b6b"
    stroke: "#333"
    stroke-width: 2
    font-color: white
    bold: true
    shadow: true
  }
}
```

### Classes (reusable styles)
```d2
classes: {
  server: {
    shape: rectangle
    style: {
      fill: "#4a90d9"
      font-color: white
    }
  }
}

api: { class: server }
auth: { class: server }
```

## Output Location

All diagrams are saved to: `diagrams/` in the repo root

## Example Usage

**Simple architecture:**
```
/d2 Create a microservices architecture with API gateway, auth service, and database
```

**Sequence diagram:**
```
/d2 Create a sequence diagram for user authentication flow
```

**SQL schema:**
```
/d2 Create an ERD for a blog with users, posts, and comments
```

**Animated SVG:**
```
/d2 --animate Create a data pipeline flow
```

## Arguments

$ARGUMENTS - The diagram description with optional flags:
- `--sketch` / `-s` - Hand-drawn aesthetic
- `--dark` / `-d` - Dark theme (default)
- `--light` / `-l` - Light theme
- `--animate` / `-a` - SVG with animations
- `--layout <engine>` - dagre, elk, or tala
